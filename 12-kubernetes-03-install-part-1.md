# Домашнее задание к занятию "12.3 Развертывание кластера на собственных серверах, лекция 1"
Поработав с персональным кластером, можно заняться проектами. Вам пришла задача подготовить кластер под новый проект.

## Задание 1: Описать требования к кластеру
Сначала проекту необходимо определить требуемые ресурсы. Известно, что проекту нужны база данных, система кеширования, а само приложение состоит из бекенда и фронтенда. Опишите, какие ресурсы нужны, если известно:

* База данных должна быть отказоустойчивой. Потребляет 4 ГБ ОЗУ в работе, 1 ядро. 3 копии.
* Кэш должен быть отказоустойчивый. Потребляет 4 ГБ ОЗУ в работе, 1 ядро. 3 копии.
* Фронтенд обрабатывает внешние запросы быстро, отдавая статику. Потребляет не более 50 МБ ОЗУ на каждый экземпляр, 0.2 ядра. 5 копий.
* Бекенд потребляет 600 МБ ОЗУ и по 1 ядру на копию. 10 копий.


План расчета
1. Сначала сделайте расчет всех необходимых ресурсов.
2. Затем прикиньте количество рабочих нод, которые справятся с такой нагрузкой.
3. Добавьте к полученным цифрам запас, который учитывает выход из строя как минимум одной ноды.
4. Добавьте служебные ресурсы к нодам. Помните, что для разных типов нод требовния к ресурсам разные.
5. Рассчитайте итоговые цифры.
6. В результате должно быть указано количество нод и их параметры.

```
Отказоустойчивость: Наличие 3 копий сервиса не означает, что он автоматически становится отказоустойчивым. Копии должны быть разнесены по разным физическим серверам (нодам) в рамках кластера.
Запас ресурсов: Нельзя планировать 100% утилизацию ресурсов. Необходим запас (обычно 15-25%) для пиковых нагрузок, для работы операционной системы и системных процессов.
Затраты оркестратора: сами компоненты K8s (kubelet, etcd, DNS) потребляют CPU и RAM на каждой ноде.
Распределение нагрузки: Ресурсы должны быть спроектированы так, чтобы при выходе из строя одной ноды, оставшиеся могли принять на себя нагрузку без коллапса.

1. База данных (Отказоустойчивая, 3 копии)
Заявленные требования на копию: 1 CPU, 4 ГБ RAM.
Рекомендация: Для Stateful-сервисов (БД) лучше не использовать "точно впритык". Важно учитывать пики активности, фоновые задачи (бэкапы, репликация).
Расчет на копию:
vCPU: 1.2 ядра (запас 20% на пиковую нагрузку).
RAM: 5 ГБ (4 ГБ + 1 ГБ запас для буферов, кэша ОС и работы самого процесса СУБД).
Итого на все копии:
CPU: 3 * 1.2 = 3.6 ядра
RAM: 3 * 5 ГБ = 15 ГБ

2. Система кеширования (Отказоустойчивая, 3 копии)
Заявленные требования на копию: 1 vCPU, 4 ГБ RAM.
Рекомендация: Кэш часто работает с большим объемом операций ввода-вывода. Запас по CPU важен для обработки сетевых пакетов и сериализации/десериализации данных.

Расчет на копию:
vCPU: 1.3 ядра (запас 30% для обработки сетевых пакетов и всплесков трафика).
RAM: 4.5 ГБ (4 ГБ + 0.5 ГБ запас для служебных процессов).
Итого на все копии:
CPU: 3 * 1.3 = 3.9 ядра
RAM: 3 * 4.5 ГБ = 13.5 ГБ

3. Фронтенд (5 копий)
Заявленные требования на копию: 0.2 vCPU, 50 МБ RAM.
Рекомендация: Для сервисов, отдающих статику, основная нагрузка — это сетевая и дисковый I/O. Однако, современные фронтенд-фреймворки могут потреблять больше памяти при рендеринге. Заложим запас.
Расчет на копию:
CPU: 0.25 ядра (запас 25% для обработки HTTP-запросов и сжатия).
RAM: 70 МБ (50 МБ + 20 МБ запас).
Итого на все копии:
CPU: 5 * 0.25 = 1.25 ядра
RAM: 5 * 70 МБ = 350 МБ

4. Бекенд (10 копий)
Заявленные требования на копию: 1 vCPU, 600 МБ RAM.
Рекомендация: Бекенд — это обычно самая изменчивая и нагруженная часть. Запас особенно важен для работы Garbage Collector (в JVM) и обработки очередей запросов.
Расчет на копию:
vCPU: 1.2 ядра (запас 20%).
RAM: 750 МБ (600 МБ + 150 МБ запас для GC, метрик, кэша приложения).
Итого на все копии:
CPU: 10 * 1.2 = 12 ядер
RAM: 10 * 750 МБ = 7.5 ГБ

Суммарные требования: ~20.75 vCPU и ~36.35 ГБ RAM.

У нас есть 3 стейтфул-сервиса (БД, Кэш) по 3 копии. Для их правильного разнесения нам нужно минимум 3 ноды.
На этих же нодах будут работать поды с бекендом и фронтендом.

Предлагаемая конфигурация нод, равно распределяем ресурсы:
На 3 ноды: ~6.92 vCPU и ~12.12 ГБ RAM на ноду
С учетом работы служебных ресурсов (На каждой ноде Kubernetes потребляет примерно 0.1-0.15 vCPU и 300-500 МБ RAM на системные демоны (kubelet, container runtime, DNS, мониторинг)) и запаса на обработку при всплесках загрузки (10-15%), рекомендуемый размер одной ноды: 8 vCPU и 16 ГБ RAM.

Итого для кластера: 3 ноды по 8 CPU/16GB RAM.
```
